{% load static %}
<!doctype html>
<html lang="en" class="{% block extra_html_class %}{% endblock %}">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block head_title %}{% endblock %}</title>
    <link rel="shortcut icon" href="{% static "mainapp/speedpy_favicon.png" %}" type="image/png">

    <!-- Theme initialization - Must run before styles load to prevent FOUC -->
    <script>
        (function() {
            function getThemePreference() {
                const stored = localStorage.getItem('theme-preference');
                if (stored) return stored;
                return 'auto'; // Default to auto mode
            }

            function getEffectiveTheme(preference) {
                if (preference === 'auto') {
                    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                }
                return preference;
            }

            const preference = getThemePreference();
            const effectiveTheme = getEffectiveTheme(preference);

            if (effectiveTheme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }

            // Store for later access
            window.__themePreference = preference;
        })();
    </script>

    <link rel="stylesheet" href="{% static "mainapp/styles.css" %}"/>
    <!-- og tags -->
    <meta property="og:title" content="{% if og_title %}{{ og_title }}{% else %}{{ SITE_TITLE }}{% endif %}">
    <meta property="og:description"
          content="{% if og_description %}{{ og_description }}{% else %}{{ TAGLINE }}{% endif %}">
    {% if og_image %}
        <meta property="og:image"
              content="{{ og_image }}">
    {% else %}
        <meta property="og:image"
              content="{{ SITE_URL }}{% url "default-og-image" %}">
    {% endif %}
    <!-- Twitter Card tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% if og_title %}{{ og_title }}{% else %}{{ SITE_TITLE }}{% endif %}">
    <meta name="twitter:description"
          content="{% if og_description %}{{ og_description }}{% else %}{{ TAGLINE }}{% endif %}">
    {% if og_image %}
        <meta name="twitter:image" content="{{ og_image }}">
    {% else %}
        <meta name="twitter:image" content="{{ SITE_URL }}{% url "default-og-image" %}">
    {% endif %}
    <meta name="twitter:site" content="@speedpycom">
    <meta name="twitter:creator" content="@speedpycom">
    <script defer src="{% static "vendors/alpine.min.js" %}"></script>
    {% block extra_head %}{% endblock %}
</head>
<body class="{% block extra_body_class %}{% endblock %}">
{% block body %}
    {% block nav %}
        {% include "components/nav.html" %}
    {% endblock %}
    {% block content %}
    {% endblock content %}

{% endblock body %}

{% block extra_body %}
{% endblock %}
{% include "components/messages.html" %}
<script src="{% static "floating-core/floating-ui.core.umd.js" %}"></script>
<script src="{% static "floating-ui/floating-ui.dom.umd.js" %}"></script>
<script src="{% static "versolyui/versoly-ui.js" %}"></script>
<script src="{% static "mainapp/index.js" %}"></script>
</body>
</html>